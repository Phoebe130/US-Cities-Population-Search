<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/ğŸ”¥" />
</head>

<body>
  <!-- åŠŸèƒ½
1.ä¸²æ¥ api æ‹¿åˆ°è³‡æ–™
2.åœ¨æœå°‹æ¬„ä¸­è¼¸å…¥é—œéµå­—å¾Œï¼Œä¸‹æ–¹é¡¯ç¤ºåŒ…å«æ­¤é—œéµå­—çš„åŸå¸‚æˆ–å·åä»¥åŠå…¶äººå£æ•¸
3.é¡¯ç¤ºæ™‚ï¼Œé—œéµå­—åº•éƒ¨è¦æœ‰é¡è‰²ï¼ˆ#ffc600ï¼‰ï¼Œäººå£æ•¸å¾Œé¢æ•¸ä¾†æ¯ 3 å€‹æ•¸å­—å‰åŠ  1 å€‹ comma -->

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
      <!-- <span class="hl">å›å‚³åˆ°é€™è£¡</span> -->
      <!-- <li>
        <span class="city">los</span>
        <span class="city">1,000,000</span>
      </li> -->
    </ul>
  </form>
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

    //å»ºç«‹ç©ºé™£åˆ— æº–å‚™æ¥apiå‚³ä¾†çš„è³‡æ–™
    const cities = []
    fetch(endpoint)
      // è§£æ JSON çš„æ–¹æ³•ï¼Œè¿”å›ä¸€å€‹æ–°çš„ Promise å°è±¡ã€‚
      .then(blob => blob.json())
      //å›  cities æ˜¯ const ç„¡æ³•å†è³¦å€¼ æ‰€ä»¥ç”¨pushæŠŠè³‡æ–™ä¸Ÿé€²å»citiesé™£åˆ—ä¸­ï¼Œ ...dataæ˜¯å±•é–‹é‹ç®—å­
      .then(data => {
        cities.push(...data);
        console.log(data);
      })
      .catch(error => {
        console.error('Fetch error:', error);
      });


    // ç›£è½inputçš„value ç•¶è¼¸å…¥æ¡†çš„å€¼ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œèª¿ç”¨ displayMatches å‡½æ•¸ã€‚
    const searchInput = document.querySelector('.search');
    const suggestions = document.querySelector('.suggestions');
    searchInput.addEventListener('change', displayMatches);
    searchInput.addEventListener('keyup', displayMatches);



    // å»ºç«‹ findMatches å‡½å¼ - æ‰¾åˆ°ç¬¦åˆç”¨æˆ¶è¼¸å…¥çš„cityæˆ–stateã€‚
    // åƒæ•¸ï¼š wordToMatchæ˜¯ç”¨æˆ¶è¼¸å…¥çš„å€¼ ; cities æ˜¯åŒ…å«åŸå¸‚å’Œå·ä¿¡æ¯çš„é™£åˆ—ã€‚
    function findMatches(wordToMatch, cities) {

      // éæ­·åŸå¸‚æ•¸æ“šé™£åˆ—ï¼Œä¸¦ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ (RegExp) é€²è¡ŒåŒ¹é…ã€‚
      return cities.filter(place => {

        // ç”¨RegExpå»ºç«‹ç¯©é¸æ¢ä»¶ å»ºç«‹æ­£è¦å¼ new RegExp(regexæ­£è¦å¼çš„å…§å®¹, flag) 
        /* g: global searchï¼Œ=> å°‹æ‰¾æ•´ä»½æ–‡ä»¶æœ‰åŒ…å«çš„ï¼Œè€Œä¸æ˜¯æ‰¾åˆ°å°±åœ 
            i:case insensitive =>ä¸å€åˆ†å¤§å°å¯« */
        const regex = new RegExp(wordToMatch, 'gi');

        // console.log(place);

        // ç”¨ match() æ¯”å°å¾Œï¼Œå›å‚³ç¬¦åˆç¯©é¸æ¢ä»¶cityæˆ–stateçš„array
        return place.city.match(regex) || place.state.match(regex)
      })
    }


    // å»ºç«‹numberWithCoommaså‡½å¼ - äººå£æ•¸æ¯ä¸‰ä½æ•¸å­—åŠ ä¸€å€‹comma (æ­£å‰‡è¡¨é”å¼)
    function numberWithCoommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
    }


    // å»ºç«‹ displayMatches å‡½å¼ - å°‡ç¬¦åˆæ¢ä»¶çš„cityæˆ–stateã€Œé¡¯ç¤ºåœ¨ç¶²é ä¸Šã€
    function displayMatches() {
      let inputValue = searchInput.value;

      // èª¿ç”¨findMatcheså‡½å¼ï¼ŒmatchArrayå„²å­˜æ‰¾åˆ°ç”¨æˆ¶è¼¸å…¥å€¼èˆ‡apiè³‡æ–™ç›¸ç¬¦çš„city stateçš„å›å‚³
      let matchArray = findMatches(inputValue, cities)
      console.log(matchArray);

      //å¯«å›HTMLï¼Œ ç”¨mapå»ºæ§‹HTMLï¼Œä¸¦åŠ å…¥cssæ¨£å¼style
      suggestions.innerHTML = matchArray.map(place => {
        // è¨­å®šç¬¦åˆæ¢ä»¶ç‚ºè¼¸å…¥çš„é—œéµå­— ï¼ˆåƒæ•¸ï¼šæ¯”è¼ƒçš„æ–‡å­—å…§å®¹æ¬„ä½,ç¯©é¸æ¢ä»¶ï¼‰
        let regex = new RegExp(inputValue, 'gi');

        // å°api place å°è±¡çš„ city å±¬æ€§æ‡‰ç”¨æ­£è¦è¡¨é”å¼  æ¸²æŸ“åœ¨html
        let cityName = place.city.replace(regex, `<span class="hl">${inputValue}</span>`);
        let stateName = place.state.replace(regex, `<span class="hl">${inputValue}</span>`)

        return `
        <li>
        <span class="city">${cityName}, ${stateName}</span>
        <span class="population">${numberWithCoommas(place.population)}</span>
      </li>`
      }).join('') //é€£çµå­—ä¸²ä¹‹é–“çš„ç¬¦è™Ÿ
    }



  </script>
</body>

</html>